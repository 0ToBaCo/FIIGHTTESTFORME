<html dir="ltr">
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.1.1/howler.min.js" type="text/javascript"></script>
        <script src="assets/javascript/jquery-3.5.1.min.js"></script>
        <script src="assets/javascript/jquery-ui.js"></script>
        <script src="assets/javascript/fontawesome.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/wheelnav@1.7.1/js/dist/raphael.min.js"></script>
        <script src="assets/javascript/wheelnav.min.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="assets/style/style.css">
        <script>
            $(document).ready(function() {
                var fightname = '';
                var windowtype = '';
                window.addEventListener('message', function(event) {
                    var item = event.data;
                    if (item.dead) {
                        $(".beat").css("display", "block");
                    }
                    if (item.alive) {
                        $(".beat").css("display", "none");
                    }
                    if (item.showPlayerFight) {
                        fightname = item.name;
                        $(".fightBox").slideDown(300);
                    }
                    if (item.showmainFight) {
                        $(".mainFight .fightRound #totalround").text(item.round);
                        $(".mainFight").css("display", "block");
                    }
                    if (item.increaseround) {
                        var old2 = $(".mainFight .team_" + Number(item.team) + " h").text();
                        $(".mainFight .team_" + Number(item.team) + " h").text(Number(old2) + 1);
                    }
                    if (item.endmatch) {
                        $(".mainFight .team_1 h").text("0");
                        $(".mainFight .team_2 h").text("0");
                        $(".mainFight .fightRound #totalround").text("1");
                        $(".mainFight").css("display", "none");
                    }
                    if (item.teamwinner) {
                        if (item.title == "LOSER") {
                            var audio = new Audio("https://cdn.discordapp.com/attachments/742942199393812601/842761838685061159/WhatsApp_Audio_2021-05-14_at_4.53.21_PM.mp4");
                            audio.play();
                            audio.volume = 0.6;
                        } else {
                            var audio = new Audio("https://cdn.discordapp.com/attachments/742942199393812601/842761847857479690/WhatsApp_Audio_2021-05-14_at_4.53.00_PM.mp4");
                            audio.play();
                            audio.volume = 0.6;
                        }
                        $(".winnerMain").removeClass("team1").removeClass("team2").addClass(item.teamname);
                        $(".winnerMain .winner").removeClass("team1").removeClass("team2").addClass(item.teamname);
                        $(".winnerMain .score h").text(item.score);
                        $(".winnerMain .winner h").text(item.title);
                        $(".winnerMain .team h").text(item.teamtitle);
                        $(".winnerMain .team").attr("title", item.teamtitle);
                        $(".winnerMain").slideDown(200);
                        setTimeout(function() {
                            $(".winnerMain").slideUp(200);
                        }, 10000);
                    }
                    if (item.freezeTime) {
                        var timetitle = 5;
                        $(".freezeTimer").html(`<section class="item"><h>${timetitle--}</h></section>`);
                        var timer1 = setInterval(function() {
                            $(".freezeTimer").html(`<section class="item"><h>${timetitle--}</h></section>`);
                            if (timetitle <= -1) {
                                clearInterval(timer1);
                                $(".freezeTimer").html(`<section class="go"><h>GO!</h></section>`);
                                setTimeout(function() { $(".freezeTimer").empty(); }, 1000);
                            }
                        }, 1000);
                    }
                    if (item.showAllFights) {
                        var data = item.data;
                        var allfights = item.allfights;
                        windowtype = "showallfights";
                        $(".showallfight .container").empty();
                        $.each(data, function(d, dd) {
                            var teamA = `<section class="team1"><h>الفريق A</h><section class="result">النتيجة: ${dd.team_a_score}</section>`;
                            var teamB = `<section class="team2"><h>الفريق B</h><section class="result">النتيجة: ${dd.team_b_score}</section>`;
                            $.each(dd.users, function(teamA_d, teamA_dd) {
                                if (teamA_dd.team == "1") teamA += `<section class="user" fight-name="${dd.name}" user-id="${teamA_dd.user_id}">${teamA_dd.user_id} | ${teamA_dd.username}&nbsp;<i class="far fa-eye"></i></section>`;
                                else teamB += `<section class="user" fight-name="${dd.name}" user-id="${teamA_dd.user_id}">${teamA_dd.user_id} | ${teamA_dd.username}&nbsp;<i class="far fa-eye"></i></section>`;
                            });
                            teamA += "</section>";
                            teamB += "</section>";
                            $(".showallfight .container").append(`<section class="item ${(dd.isplaying ? "playing" : "notplaying")}"><section class="fightname"><h>مباراة ${dd.name}</h></section><section class="items">${teamA}${teamB}</section></section>`);
                        });
                        $(".showallfight .container").append(`<section style="text-align: center; font-size: 25px; padding: 10px"><h>المباريات السابقة</h></section>`);
                        $.each(allfights, function(d, dd) {
                            var teamA = `<section class="team1"><h>الفريق A</h><section class="result">النتيجة: ${dd.team_a_score}</section>`;
                            var teamB = `<section class="team2"><h>الفريق B</h><section class="result">النتيجة: ${dd.team_b_score}</section>`;
                            $.each(dd.users, function(teamA_d, teamA_dd) {
                                if (teamA_dd.team == "1") teamA += `<section class="user" fight-name="${dd.name}" user-id="${teamA_dd.user_id}">${teamA_dd.user_id} | ${teamA_dd.username}</section>`;
                                else teamB += `<section class="user" fight-name="${dd.name}" user-id="${teamA_dd.user_id}">${teamA_dd.user_id} | ${teamA_dd.username}</section>`;
                            });
                            teamA += "</section>";
                            teamB += "</section>";
                            $(".showallfight .container").append(`<section class="item notplaying"><section class="fightname"><h>مباراة ${dd.name}</h></section><section class="items">${teamA}${teamB}</section></section>`);
                        });
                        $(".showallfight").css("display", "block");
                    } else if (item.srespawn) {
                        $(".respawnNew").css("display", "block");
                    } else if (item.hrespawn) {
                        $(".respawnNew").css("display", "none");
                    }
                });
                $(document).keydown(function(e) {
                    if (e.keyCode == 27) {
                        if (windowtype == "showallfights") {
                            $(".showallfight").css("display", "none");
                            $.post("https://AR_Fight/closefightbox", JSON.stringify({name: fightname}));
                        } else {
                            $(".fightBox").slideUp(300);
                            $.post("https://AR_Fight/close", JSON.stringify({name: fightname}));
                        }
                    } else if (e.keyCode == 122) {
                        $(".showallfight").css("display", "none");
                        $.post("https://AR_Fight/closefightbox", JSON.stringify({name: fightname}));
                    }
                });
                $(".fightBox .round .item").click(function() {
                    $(".fightBox .round .item").removeClass("selected");
                    $(this).addClass("selected");
                });
                $(".fightbox .start").click(function() {
                    var round = $(".round .item.selected h").text();
                    var users = [];
                    var inputs = $(".fightbox input");
                    $.each(inputs, function(d, dd) {
                        var team = $(dd).parent().parent().attr('team');
                        if ($(dd).val().trim() != '') users[d] = {team: team, user_id: $(dd).val()};
                    });
                    if (users.length > 0) {
                        $(".fightBox").slideUp(300);
                        $.post("https://AR_Fight/startFight", JSON.stringify({name: fightname, round: round, users: users}));
                    }
                });
                $(document).on('click', '.showallfight .container .user', function() {
                    $.post("http://AR_Fight/spectate", JSON.stringify({userid: $(this).attr('user-id'), name: $(this).attr('fight-name')}));
                });
            });
        </script>
    </head>
    <body>
        <section class="showallfight">
            <section class="background"></section>
            <section class="title"><h>قائمة المباريات</h></section>
            <section class="container"></section>
        </section>
        <section class="fightBox">
            <section class="title"><h>اللاعبين</h></section>
            <section class="teams">
                <section class="item team1" team="1">
                    <section class="title2"><h>الفريق A</h></section>
                    <section class="input"><input type="text" name="u1" placeholder="الايدي ..."></section>
                    <section class="input"><input type="text" name="u2" placeholder="الايدي ..."></section>
                    <section class="input"><input type="text" name="u3" placeholder="الايدي ..."></section>
                    <section class="input"><input type="text" name="u4" placeholder="الايدي ..."></section>
                </section>
                <section class="item team2" team="2">
                    <section class="title2"><h>الفريق B</h></section>
                    <section class="input"><input type="text" name="u5" placeholder="الايدي ..."></section>
                    <section class="input"><input type="text" name="u6" placeholder="الايدي ..."></section>
                    <section class="input"><input type="text" name="u7" placeholder="الايدي ..."></section>
                    <section class="input"><input type="text" name="u8" placeholder="الايدي ..."></section>
                </section>
            </section>
            <section class="title"><h>الجولات</h></section>
            <section class="round">
                <section class="item selected"><h>3</h></section>
                <section class="item"><h>5</h></section>
                <section class="item"><h>7</h></section>
                <section class="item"><h>9</h></section>
                <section class="item"><h>12</h></section>
            </section>
            <section class="start"><h>بدء المباراة</h></section>
        </section>
        <section class="mainFight">
            <section class="game_round">
                <section class="ftitle"><h>FIGHT</h></section>
                <section class="background1"></section>
            </section>
            <section class="items">
                <section class="item team_2"><section class="avatar"><img src="https://cdn.discordapp.com/attachments/755222119813742604/841873872152035328/lion.jpg"></section><h>0</h></section>
                <section class="item fightRound"><h><h id="totalround">0</h></h></section>
                <section class="item team_1"><section class="avatar"><img src="https://cdn.discordapp.com/attachments/755222119813742604/841874333756162068/dragon.jpg"></section><h>0</h></section>
            </section>
        </section>
        <section class="winnerMain">
            <section class="score"><h></h></section>
            <section class="winner"><h></h></section>
            <section class="team" title=""><h></h></section>
        </section>
        <section class="freezeTimer"></section>
    </body>
</html>